function WPProjectBuilder(){this.packageListElement=null;this.qttSelectedPackages=0;this.currentDownloadPackage=0;this.packageList=[];this.init=function(){WPProjectBuilder.validateActiveBuildAction();WPProjectBuilder.validateActiveNewPluginAction();WPProjectBuilder.loadPluginList()};this.loadPluginList=function(){var d=document,e=d.getElementById("plugin-list"),c="",a=0,b=0;e.innerHTML="carregando plugins...";ajax({url:"action/get-plugin-list",type:"GET",dataType:"json",success:function(f){a=f.length;c='<ul class="choice-options multiple-options">';for(b=0;b<a;b++){c+="<li>";c+='    <a class="option-description" data-plugin-name="'+f[b].name+'" onclick="WPProjectBuilder.selectOption(this);" href="javascript:void(0);">'+f[b].title+"</a>";c+='    <a target="_blank" href="https://wordpress.org/plugins/'+f[b].name+'/" class="plugin-info">i</a>';c+="</li>"}c+="</ul>";e.innerHTML=c}})};this.selectOption=function(d){var c=d.parentNode.parentNode,e=c.children,a=e.length,b=0;d.classList.toggle("selected");if(c.classList.contains("single-option")){for(b=0;b<a;b++){if(e[b].firstElementChild!=d){e[b].firstElementChild.classList.remove("selected")}}}WPProjectBuilder.validateActiveBuildAction()};this.validateActiveBuildAction=function(){var g=document,e=g.getElementById("btn-build-project"),b=e.classList,f=g.querySelectorAll("#build-config-core a"),d=f.length,a=false,c=0;for(c=0;c<d;c++){if(f[c].classList.contains("selected")){a=true;break}}if(a){e.setAttribute("onclick","WPProjectBuilder.build();");e.setAttribute("title","clique para gerar o build do seu projeto");b.remove("btn-inactive")}else{e.removeAttribute("onclick");e.setAttribute("title","escolha uma versÃ£o do core do wp");b.add("btn-inactive")}};this.newPluginIsValid=function(){return(document.getElementById("new-plugin-url").value!=="")?true:false};this.validateActiveNewPluginAction=function(){var b=document,a=b.getElementById("new-plugin-submit").classList;if(WPProjectBuilder.newPluginIsValid()){a.remove("inactive")}else{a.add("inactive")}};this.addNewPlugin=function(){var f=document,c=f.getElementById("build-config-plugins"),e=f.getElementById("build-container"),g=f.createElement("div"),d="adding-plugin",a="",b="";if(WPProjectBuilder.newPluginIsValid()){b+='<div class="loading-layer-icon"></div>';b+='<div class="loading-layer-message">adicionando plugin...</div>';b+='<a href="javascript:void(0);" class="btn btn-primary close-loading-layer" onclick="WPProjectBuilder.closeOverlay(\''+d+"'); document.querySelector('#build-config-plugins .accordion-menu-content').style.display = 'block';\">voltar</a>";g.setAttribute("id",d);g.setAttribute("class","loading-layer-container");g.innerHTML=b;f.querySelector("#build-config-plugins .accordion-menu-content").style.display="none";c.appendChild(g);e.classList.add(d);ajax({url:"action/add-new-plugin",type:"POST",dataType:"json",data:{url:f.getElementById("new-plugin-url").value},success:function(h){if(h.statusCode==1){WPProjectBuilder.loadPluginList();a="success"}else{a="error"}WPProjectBuilder.loadPluginList();f.getElementById(d).classList.add(a);f.querySelector("#"+d+" .loading-layer-message").innerHTML=h.message;f.querySelector("#"+d+" .close-loading-layer").style.display="block";e.classList.remove(d);f.getElementById("new-plugin-url").value="";f.getElementById("new-plugin-submit").setAttribute("class","inactive")}})}return false};this.closeOverlay=function(a){var b=document.querySelector("#"+a+".loading-layer-container");b.parentNode.removeChild(b)};this.build=function(){var o=document,l=o.querySelectorAll(".single-option .option-description"),a=o.querySelectorAll(".multiple-options .option-description"),n=o.getElementById("build-container"),c=o.createElement("div"),p=a.length,k=l.length,g="",f="",h=[],b=[],e=0,d=0,m=0,q=0;for(e=0;e<k;e++){if(l[e].classList.contains("selected")){g+='<li data-package-name="'+l[e].innerHTML+'" class="download-pending">'+l[e].innerHTML+"<i></i></li>";h[m]=l[e].innerHTML;m++}}for(d=0;d<p;d++){if(a[d].classList.contains("selected")){b[q]=a[d].getAttribute("data-plugin-name");g+='<li data-package-name="'+b[q]+'" class="download-pending">'+b[q]+"<i></i></li>";q++}}g+='<li class="download-pending">empacotando projeto<i></i></li>';f+='<div class="loading-layer-icon"></div>';f+='<div class="loading-layer-message">gerando build do projeto...</div>';f+='<a href="javascript:void(0);" id="download-build-link"></a>';f+='<div class="loading-layer-content">';f+='    <p class="description">baixando pacotes selecionados</p>';f+='    <ul id="downloading-selected-plugins">'+g+"</ul>";f+="</div>";c.setAttribute("id","loading-build");c.setAttribute("class","loading-layer-container");c.innerHTML=f;n.appendChild(c);n.classList.add("generating-build");WPProjectBuilder.manageDownloadPackages(h,b)};this.manageDownloadPackages=function(b,a){WPProjectBuilder.packageListElement=document.querySelectorAll("#downloading-selected-plugins li");WPProjectBuilder.packageList=b.concat(a);WPProjectBuilder.qttSelectedPackages=WPProjectBuilder.packageList.length;WPProjectBuilder.downloadPackage(0)};this.downloadPackage=function(a){var e=document,b=e.getElementById("download-build-link"),d=WPProjectBuilder.packageListElement[a],c=d.classList,f=e.getElementById("loading-build");c.remove("download-pending");c.add("download-in-progress");if(a<WPProjectBuilder.qttSelectedPackages){ajax({url:"action/download-package",type:"POST",dataType:"json",data:{name:d.getAttribute("data-package-name"),type:((a===0)?"core":"plugin")},success:function(g){c.remove("download-in-progress");c.add("download-"+((g)?"finished":"error"));WPProjectBuilder.downloadPackage((parseInt(a)+1))}})}else{ajax({url:"action/packaging-build",type:"GET",dataType:"json",success:function(g){c.remove("download-in-progress");c.add("download-"+((g)?"finished":"error"));b.href="action/download-build?build_id="+g.data.buildId;b.style.display="block";f.classList.add("success");e.querySelector("#loading-build .loading-layer-message").innerHTML="build gerado com sucesso!"}})}}}var WPProjectBuilder=new WPProjectBuilder();WPProjectBuilder.init();